<script>
function generateTable() {
    const dateEffet = document.getElementById('dateEffet').value;
    if (!dateEffet) return;

    const tableContainer = document.getElementById('tableContainer');
    tableContainer.innerHTML = '';
    const table = document.createElement('table');

    const headerRow = document.createElement('tr');
    ['Mois', 'Pension (€)', 'Salaires (€)', 'Indemnités journalières (€)', 'Chômage (€)', 'Autres ressources (€)', 'Total (€)'].forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    for (let i = 0; i < 12; i++) {
        const row = document.createElement('tr');
        const monthCell = document.createElement('td');
        const date = new Date(dateEffet);
        date.setMonth(date.getMonth() - i - 1);
        monthCell.textContent = date.toLocaleDateString('fr-FR', { year: 'numeric', month: 'long' });
        row.appendChild(monthCell);

        ['pension', 'salaires', 'indemnites', 'chomage', 'autres'].forEach(type => {
            const cell = document.createElement('td');
            const input = document.createElement('input');
            input.type = 'number';
            input.name = `${type}_${i}`;
            input.min = 0;
            input.oninput = () => calculateRowTotal(row);
            cell.appendChild(input);
            row.appendChild(cell);
        });

        const totalCell = document.createElement('td');
        totalCell.className = 'row-total';
        totalCell.textContent = '0';
        row.appendChild(totalCell);

        table.appendChild(row);
    }

    tableContainer.appendChild(table);
}

function calculateRowTotal(row) {
    const inputs = row.querySelectorAll('input');
    const total = Array.from(inputs).reduce((sum, input) => sum + Number(input.value || 0), 0);
    row.querySelector('.row-total').textContent = total.toFixed(2);
}
</script>
